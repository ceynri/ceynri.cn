---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';

import { BaseHead, FormattedDate } from '~/components';
import { SITE_DESCRIPTION, SITE_TITLE } from '~/consts';
import { AsideLayout } from '~/layouts';

const posts = (await getCollection('blog'))
  .filter((post) => import.meta.env.MODE === 'development' || post.data.published)
  .sort(
    (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
  );
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <BaseHead
      title={SITE_TITLE}
      description={SITE_DESCRIPTION}
    />
  </head>
  <body>
    <AsideLayout>
      {
        posts.map((post) => (
          <div class="mb-8 rounded-2xl overflow-hidden bg-[var(--prose-bg-color)] transition-[background-color,box-shadow,transform] hover:shadow-2xl hover:-translate-y-1">
            <a href={`/blog/${post.slug}/`}>
              {post.data.cover_image && (
                <Image
                  class="w-full aspect-[9/4] max-sm:aspect-square object-cover"
                  src={post.data.cover_image}
                  alt=""
                />
              )}
              <div class={`p-16 max-sm:p-8 ${post.data.cover_image ? 'pt-12 max-sm:pt-6' : ''}`}>
                <h2 class="mt-0 mb-4 text-3xl font-bold">{post.data.title}</h2>
                {post.data.description && <p class="mb-4 text-lg">{post.data.description}</p>}
                <p class="text-base text-[var(--text-secondary-color)] mb-0">
                  <FormattedDate date={post.data.date} />
                </p>
              </div>
            </a>
          </div>
        ))
      }
    </AsideLayout>
  </body>
</html>
